<!--<div class="namespace">
    <span>Namespace:</span>
    <namespace-autocomplete (nschange)="setNamespace($event)" *ngIf="namespaceEdit" [value]="namespace"></namespace-autocomplete>
    <span (click)="namespaceEdit=true" *ngIf="!namespaceEdit">{{ namespace }}</span>
</div>-->
<div class="query" [style.height]="'400px'">
    <div>
        <div class="metrics">
            <div class="caption">METRIC(S)</div>
            <div class="metric" *ngFor="let metric of query.metrics"> {{ metric.name }} </div>
            <div class="metric" *ngIf="addMetricEnabled">
                <mat-form-field appearance="fill" [color]="'primary'" floatLabel="never">
                    <input type="text" matInput 
                        #metricSearchInput 
                        placeholder="Enter Metric"  
                        [formControl]="metricSearchControl" 
                        (keydown.enter)="metricSearchKeydown($event)"
                        [matAutocomplete]="metricAutocomplete">
                </mat-form-field>
                <mat-autocomplete #metricAutocomplete="matAutocomplete" (optionSelected)="metricOptionSelected($event)">
                        <mat-option *ngFor="let option of metricOptions" [value]="option">
                            {{ option }}
                        </mat-option>
                </mat-autocomplete>
            </div>
            <div class="metric-add-btn"><button mat-stroked-button color="primary" class="mat-elevation-z0" (click)="showMetricAdd()">Add Metric</button></div>
        </div>
        <div class="tags">
            <div class="container">
                <div class="tag-key">
                    <div class="caption">TAG KEY(S)</div>
                    <div class="filter">
                        <div class="search"><input #tagSearchInput [formControl]="tagSearchControl"></div>
                    </div>
                    <div class="list has-scroller">
                        <div class="is-scroller">
                            <div class="option" *ngFor="let option of filteredTagOptions | async" (click)="loadTagValues(option)" 
                                [ngClass]="query.filters[selectedTagIndex] && query.filters[selectedTagIndex].tagk===option?'selected': isInfilteredKeys(option)!==-1?'added':''">
                                    {{ option }}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tag-values">
                        <div class="caption">ADD TAG VALUE(S) TO THE RIGHT</div>
                        <div class="filter">
                            <div class="search"><input #tagValueSearchInput [formControl]="tagValueSearchControl"></div>
                            <div class="type">
                                <button>Literal</button>
                                <button>Regex</button>
                            </div>
                        </div>
                        <div class="list has-scroller">
                            <div class="is-scroller">
                                <div class="option" *ngFor="let option of filteredTagValues">
                                    <mat-icon (click)="addTagValue(option);">add_circle_outline</mat-icon>
                                    <div>{{ option }}</div>
                                </div>
                                <div *ngIf="message.tagValueControl.message" [ngClass]="message.tagValueControl.type === 'error'? 'error': 'info'">
                                    {{ message['tagValueControl']['message'] }}
                                </div>
                            </div>
                        </div>
                </div>
                <div class="tag-values-selected">
                    <div class="caption">SELECTED TAG VALUE(S)</div>
                    <div class="list has-scroller" *ngIf="query.filters[selectedTagIndex]">
                        <div class="is-scroller">
                            <div class="option" *ngFor="let option of query.filters[selectedTagIndex].filter" >
                                    <mat-icon (click)="removeTagValue(option)">remove_circle_outline</mat-icon>
                                   <span> {{ option }} </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="action">
            <button mat-stroked-button color="primary" class="mat-elevation-z0" (click)="apply()"> Apply </button>
            <button mat-stroked-button  class="mat-elevation-z0" (click)="cancel()"> Cancel </button>
    </div>
</div>
<!--<div class="metric-tags">
    <span><strong>Tags:</strong></span>
    <mat-chip-list>
        <span *ngFor="let tag of query.filters">
            <span class="key">{{ tag.tagk }}:</span>
            <span class="value" (click)="setEditTagValue( tag.tagk, tag.filter ); $event.stopPropagation()" *ngIf="editTagValue !== tag.tagk  "> 
                {{ tag.filter }}
                <mat-icon *ngIf="tag.tagk ==='metric' && currentTag!== 'metric' && !tag.filter.length">error</mat-icon>
            </span>
            <span class="value-control">
                <app-namespace-tag-values *ngIf="editTagValue === tag.tagk  " [namespace]="namespace" [value]="tag.filter" [tagkey]="tag.tagk" [tagsSelected]="tags" (tagValueChange)="setTagValue($event, tag.tagk)"></app-namespace-tag-values>
            </span>
        </span>
    </mat-chip-list>
    <namespace-tag-autocomplete [namespace]="namespace"  [tagsSelected]="tags" (tagchange)="setTag($event)" *ngIf="showTagControl" (blur)="showAddTagButton()"></namespace-tag-autocomplete>

    <app-namespace-tag-values [namespace]="namespace" [tagkey]="currentTag" [tagsSelected]="tags" *ngIf="showTagValueControl" (tagValueChange)="setTagValue($event, currentTag)" (blur)="setTagDefaultValue()"></app-namespace-tag-values>
    <button mat-button mat-stroked-button mat-primary color="primary" *ngIf="namespace!='' && !showTagControl && !showTagValueControl" (click)="activateTagAutoSuggest()">+</button>
</div>
<div class="expression-metrics" *ngIf="query.settings && query.settings.expanded">
        <div class="metric" *ngFor="let emetric of query.metrics">
            <div class="metric-alias">
                <span>{{ emetric.id }}</span>
            </div>
            <div class="metric-label">{{ emetric.metric }}</div>
        </div>
</div>-->
