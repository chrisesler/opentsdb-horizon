<div class="gif-spinner" *ngIf="loading">
    <img src="/assets/spinner-26x26.gif" />
</div>

<div class="event-stream-list" *ngIf="events">
    <mat-accordion class="event-accordion" displayMode="flat" multi="true" #eventAccordion>
        <ng-container *ngFor="let event of slicedList(); let i = index">
            <mat-expansion-panel class="event-panel" #eventPanel expanded="{{expandedBucketIndex === i}}" (opened)="openExpansion(i)" (closed)="collapseExpansion(i)">
                <mat-expansion-panel-header collapsedHeight="32px" expandedHeight="32px" >
                    <mat-panel-title>
                        <span class="event-time">{{util.buildDisplayTime(event.timestamp, startTime, endTime, true, timezone)}}</span>
                        <!-- <span class="event-source"> {{event.source}} </span> -->
                        <span class="event-title"> {{event.title}} </span> 
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <div *ngIf="expandedBucketIndex === i" class="event-summary">

                    <div class="event-tags">
                        <fieldset *ngIf="event.tags" class="event-tags">
                            <legend>Tags</legend>
                            <!-- <div class="tag-value">Tags</div> -->
                            <div class="event-tag" *ngFor="let tag of getTags(event.tags); let last = last">
                                <span class="tag-key">{{ tag.key }}:</span>
                                <!-- {{ tag.key }}: {{ tag.value }} -->
                                <strong class="tag-value">{{ tag.value }}</strong>
                            </div>
                        </fieldset>
                    </div>

                    <div class="event-details">
                        <fieldset>
                            <legend> Properties </legend>
                            <div class="event-property">
                                <span>namespace:</span> <strong>{{event.namespace}}</strong>
                            </div>
    
                            <div class="event-property">
                                <span>source:</span> <strong>{{event.source}}</strong>
                            </div>
    
                            <div class="event-property" *ngIf="event.priority">
                                <span>priority:</span> <strong>{{event.priority}}</strong>
                            </div>
    
                            <div *ngIf="event.additionalProps">
                                <div class="event-property" *ngFor="let tag of getTags(event.additionalProps)">
                                    <span>{{tag.key}}: </span> <strong>{{tag.value}}</strong>
                                </div>
                            </div>
                        </fieldset>
                    </div>

                    <div class="event-message">
                        <fieldset>
                            <legend>Message</legend>
                            <div class="event-details-text-wrapper">
                                <div class="event-details-text">
                                    {{event.message}}
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </mat-expansion-panel>
        </ng-container>
    </mat-accordion>
</div>

<div class="no-events-message" *ngIf="(!events || events.length === 0) && !loading">
    No events.
</div>
